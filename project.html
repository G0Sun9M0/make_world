<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>😘Wordle(고성모, 서상호)</title>
    <style>
        input {
            width: 50px;
            height: 50px;
            border: 1 solid #e5e7eb;
            font-size: 35px;
            border-radius: .375rem;
            text-align: center;
            margin: 0.3px; 
        }
        body {
            text-align: center;
        }
        nav {
            margin-top: 1px;
            font-size: 18px;
        }
        #timer, #attempts, #stage, #timeLimit {
            font-size: 18px;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1>😘Wordle</h1>
    <hr>
    <nav>
        <div>현재 단계: <span id="currentStage">1</span> / 6</div>
        <div id="timer">플레이 시간: <span id="time">00:00</span></div>
        <div id="timeLimit">남은 시간: <span id="remainingTime">60</span>초</div>
        <div id="attempts">시도 횟수: <span id="attemptCount">0</span></div>
    </nav>

    <section id="gameSection">
        <br>
        <input class="input" maxlength="1">
        <input class="input" maxlength="1">
        <input class="input" maxlength="1">
        <input class="input" maxlength="1">
        <input class="input" maxlength="1">
        <input class="input" maxlength="1">
    </section>

    <script>
        var 단어목록 = ['sensor', 'laptop', 'animal', 'window', 'person', 'school', 'friend', 'family', 'number', 'garden'];  
        var 단계 = 1;
        var 최대단계 = 6;
        var 답 = 단어목록[Math.floor(Math.random() * 단어목록.length)];
        console.log(답);

        var 시도횟수 = 0;
        var 타이머작동중 = false;
        var 시작시간, 제한시간 = 60;  // 1단계에서 60초 제한
        var 제한시간타이머;

        function updateTimer() {
            var 현재시간 = new Date();
            var 경과시간 = Math.floor((현재시간 - 시작시간) / 1000);
            var 분 = String(Math.floor(경과시간 / 60)).padStart(2, '0');
            var 초 = String(경과시간 % 60).padStart(2, '0');
            document.getElementById('time').textContent = `${분}:${초}`;
        }

        function startTimeLimitTimer() {
            var 남은시간 = 제한시간;
            document.getElementById('remainingTime').textContent = 남은시간;
            
            제한시간타이머 = setInterval(function() {
                남은시간--;
                document.getElementById('remainingTime').textContent = 남은시간;

                if (남은시간 <= 0) {
                    clearInterval(제한시간타이머);
                    alert("시간 초과! 게임이 종료됩니다.");
                    resetGame();
                }
            }, 1000);
        }

        function 제출하기() {
            시도횟수++;
            document.getElementById('attemptCount').textContent = 시도횟수;

            var input = document.querySelectorAll('.input');
            var 맞춘갯수 = 0;

            for (let i = 0; i < 6; i++) {
                if (input[i].value === 답[i]) {
                    input[i].style.background = '#22c55e';
                    맞춘갯수++;
                } else if (답.includes(input[i].value)) {
                    input[i].style.background = '#eab308';
                } else {
                    input[i].style.background = '#6b7280';
                    input[i].style.color = '#ffffff';
                }
                input[i].classList.remove('input');
            }

            if (맞춘갯수 === 6) {
                alert(`성공! ${시도횟수}번 만에 맞췄습니다.`);

                if (단계 < 최대단계) {
                    단계++;
                    제한시간 -= 10;  // 다음 단계로 넘어갈 때마다 10초씩 감소
                    document.getElementById('currentStage').textContent = 단계;
                    다음단계();
                } else {
                    완료();
                }
                return;
            }

            var template = `
            <div style="margin-top: 5px;">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
            </div>`;
            document.querySelector('#gameSection').insertAdjacentHTML('beforeend', template);
            setInputFilter();
            setAutoTab();
        }

        function setInputFilter() {
            var inputs = document.querySelectorAll('.input');
            inputs.forEach(function(input) {
                input.addEventListener('input', function() {
                    this.value = this.value.replace(/[^a-zA-Z]/g, '').toLowerCase();
                });
            });
        }

        function setAutoTab() {
            var inputs = document.querySelectorAll('.input');
            inputs.forEach(function(input, index) {
                input.addEventListener('input', function() {
                    if (!타이머작동중 && this.value !== '') {
                        시작타이머();  // 첫 입력 시 스톱워치 시작
                        startTimeLimitTimer();  // 제한 시간 타이머 시작
                    }
                    if (this.value.length === 1 && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                });
                input.addEventListener('keydown', function(event) {
                    if (event.key === 'Backspace' && input.value === '' && index > 0) {
                        inputs[index - 1].focus();
                    }
                });
            });
        }

        function 시작타이머() {
            if (!타이머작동중) {
                시작시간 = new Date();
                타이머작동중 = true;
                setInterval(updateTimer, 1000);  // 스톱워치 작동
            }
        }

        function resetGame() {
            location.reload();
        }

        function 다음단계() {
            clearInterval(제한시간타이머);  // 이전 단계의 제한 시간 타이머 종료

            // 새로운 단어로 설정
            답 = 단어목록[Math.floor(Math.random() * 단어목록.length)];
            console.log(`새로운 단어: ${답}`);
            
            시도횟수 = 0;  // 시도 횟수 초기화
            document.getElementById('attemptCount').textContent = 시도횟수;
            
            // 기존 입력 필드 초기화
            document.getElementById('gameSection').innerHTML = `
                <br>
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">
                <input class="input" maxlength="1">`;

            setInputFilter();
            setAutoTab();

            // 제한 시간 리셋
            document.getElementById('remainingTime').textContent = 제한시간;
            startTimeLimitTimer();
        }

        function 완료() {
            document.body.innerHTML = `
                <h1>게임 완료</h1>
                <p>모든 단계를 성공했습니다!</p>
                <button onclick="resetGame()">다시 시작</button>`;
            
            clearInterval(제한시간타이머);
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                제출하기();
                var inputs = document.querySelectorAll('.input');
                if (inputs.length > 0) {
                    inputs[0].focus();
                }
            }
        });

        setInputFilter();
        setAutoTab();
    </script>
</body>
</html>